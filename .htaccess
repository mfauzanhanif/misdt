<IfModule mod_rewrite.c>
    RewriteEngine On

    # 1. PAKSA HTTPS DI TITIK TERDEPAN (Mencegah redirect berlapis)
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # 2. Meneruskan header authorization (Krusial untuk Sanctum/API)
    RewriteCond %{HTTP:Authorization} ^(.*)
    RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

    # 3. Menyembunyikan daftar direktori untuk keamanan
    Options -Indexes

    # 4. SILENT REWRITE: Arahkan semua request ke folder public secara diam-diam
    # Tanpa flag R=301 di sini agar browser tidak mendeteksi adanya pengalihan
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteRule ^(.*)$ public/$1 [L,QSA]
</IfModule>
